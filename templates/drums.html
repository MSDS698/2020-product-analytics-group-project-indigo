<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://cdn.jsdelivr.net/npm/@magenta/music@^1.2.3"></script>
    <script src="https://unpkg.com/@tonejs/midi"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
</head>
<body>
    <label>Select from samples:</label>
    <div id="1">
        <select id="samples">
            <option disabled selected value="">Please select a sample</option>
            <option value="bass_4bars.mid">Bass Sample 4 Bars</option>
            <option value="rock_licks_excerpt.mid">Guitar Sample 4 Bars</option>
            <option value="chuck_berry_8bars.mid">Guitar Sample 8 Bars</option>
        </select>
        <button type="button" id="playbutton" style="display:none">Play Sample</button>
        <button type="button" id="stopbutton" style="display:none">Stop</button>
    </div>
    <div id="2">
        <button type="button" id="drums_rnn" style="display:none">Generate Drum Beat</button>
    </div>
    <div id="3">
        <button type="button" id="combined" style="display:none">Play Combined Sample</button>
    </div>
</body>
<script>
    $('#samples').on('change', function () {
        mm.urlToNoteSequence('/static/guitar_bass_samples/'+this.value)
        .then(ns_val => note_seq = ns_val)
        .then(unimportant => quant_note_seq = mm.sequences.quantizeNoteSequence(note_seq, 4))
        .then($("#playbutton").show())

        drums_rnn = new mm.MusicRNN('https://storage.googleapis.com/magentadata/js/checkpoints/music_rnn/drum_kit_rnn');
        drums_rnn.initialize()
        .then(function(){$("#drums_rnn").show()});
    });

    const main_player = new mm.SoundFontPlayer('https://storage.googleapis.com/magentadata/js/soundfonts/sgm_plus');

    $("#playbutton").click(function(){
        main_player.start(note_seq);
        $("#stopbutton").show()
    });

    $("#stopbutton").click(function(){
        main_player.stop()
    });

    $("#drums_rnn").click(function(){
        steps = quant_note_seq["totalQuantizedSteps"];

        drums_rnn.continueSequence(quant_note_seq, steps, 1.2)
        .then(function(sample) {
            generated = sample;
            main_player.start(generated);
            $("#combined").show();
        })
    });

    $("#combined").click(function(){
        var combined_sequence = mm.sequences.clone(quant_note_seq);
        combined_sequence['notes'].push(...generated['notes']);
        main_player.start(combined_sequence);
    });

</script>
</html>